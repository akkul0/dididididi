<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Way to Diliara</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="https://i.imgur.com/ISiHksj.png">

    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        /* --- GENEL AYARLAR & MOBÄ°L OPTÄ°MÄ°ZASYON --- */
        body { 
            background-color: #000; margin: 0; padding: 0; 
            width: 100vw; height: 100vh; overflow: hidden; 
            display: flex; justify-content: center; align-items: center; 
            color: white; font-family: 'Press Start 2P', cursive; 
            user-select: none; -webkit-touch-callout: none;
            overscroll-behavior: none; /* Sayfa yenilemeyi engelle */
        }
        
        #game-wrapper { 
            position: relative; width: 800px; height: 600px; 
            box-shadow: 0 0 50px rgba(255, 255, 255, 0.1); 
            transform-origin: center center; 
        }
        #game-screen { 
            width: 100%; height: 100%; position: relative; 
            background-color: #111; overflow: hidden; border: 2px solid #333; 
        }
        
        /* NESNELER */
        .game-obj { image-rendering: pixelated; position: absolute; transition: transform 0.1s; pointer-events: none; z-index: 20; }
        .bg { width: 100%; height: 100%; object-fit: cover; z-index: 1; }
        
        /* Karakterler */
        .character { z-index: 100; width: 64px; height: 64px; }
        .npc { z-index: 90; width: 64px; height: 64px; position: absolute; transition: all 0.5s linear; }

        /* ARAYÃœZ KATMANLARI */
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 5000; display: flex; flex-direction: column; justify-content: flex-end; }
        
        /* SES KONTROLÃœ */
        #volume-control {
            position: absolute; top: 20px; right: 20px; z-index: 9500;
            display: flex; align-items: center; background: rgba(0,0,0,0.5);
            padding: 10px; border-radius: 10px; border: 1px solid white;
            pointer-events: auto; touch-action: manipulation;
        }
        #volume-slider { width: 100px; margin-left: 10px; cursor: pointer; }

        /* DÄ°L SEÃ‡Ä°M EKRANI */
        #lang-screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; pointer-events: auto; }
        .lang-btn { background: #3498db; color: white; border: 2px solid #fff; padding: 20px 40px; margin: 10px; font-family: inherit; font-size: 16px; cursor: pointer; touch-action: manipulation; }
        .lang-btn:hover { background: #2980b9; transform: scale(1.05); }

        /* MENÃœ */
        #main-menu { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(10, 10, 10, 1); z-index: 8000; display: none; flex-direction: column; justify-content: center; align-items: center; pointer-events: auto; }
        .title-container { display: flex; align-items: center; margin-bottom: 20px; transform: scale(0.9); }
        .menu-char { width: 80px; height: 80px; margin: 0 10px; }
        h1.title { color: #ffcc00; font-size: 24px; line-height: 1.5; text-align: center; }
        .menu-btn { background: #c0392b; color: white; border: 3px solid #fff; padding: 15px 30px; font-family: inherit; font-size: 18px; cursor: pointer; margin-top: 20px; touch-action: manipulation; }

        /* DÄ°YALOG KUTUSU */
        #dialogue-box { 
            position: absolute; bottom: 160px; left: 5%; width: 90%; 
            background: rgba(0, 0, 0, 0.9); border: 2px solid white; 
            padding: 15px; box-sizing: border-box; display: none; 
            font-size: 12px; line-height: 1.6; text-align: center; color: #ffeb3b;
            pointer-events: auto; z-index: 6000;
        }

        /* HÄ°KAYE EKRANI */
        #narrative-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: black; z-index: 7000; display: none;
            justify-content: center; align-items: center; text-align: center;
            padding: 40px; box-sizing: border-box;
        }
        #narrative-text {
            font-size: 16px; line-height: 2; color: #fff; white-space: pre-wrap;
        }

        /* FÄ°NAL SEÃ‡Ä°M */
        #choice-container {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            display: none; flex-direction: column; gap: 20px; z-index: 7500; pointer-events: auto;
        }
        .choice-btn {
            background: #222; color: white; border: 2px solid #fff;
            padding: 20px 40px; font-family: inherit; font-size: 16px; cursor: pointer;
            transition: 0.2s; text-align: center; touch-action: manipulation;
        }
        .choice-btn:hover { background: #444; transform: scale(1.05); }

        #end-screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 9000; pointer-events: auto; }

        /* MOBÄ°L KONTROLLER - GELÄ°ÅžTÄ°RÄ°LDÄ° */
        #mobile-controls { width: 100%; height: 150px; display: flex; justify-content: space-between; padding: 20px; box-sizing: border-box; pointer-events: none; }
        .d-pad, .action-area { pointer-events: auto; position: relative; }
        .d-pad { width: 150px; height: 150px; } .action-area { width: 100px; height: 150px; display: flex; align-items: center; justify-content: center; }
        
        .btn { 
            position: absolute; background: rgba(255, 255, 255, 0.15); border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 8px; 
            display: flex; justify-content: center; align-items: center; font-size: 20px; color: rgba(255,255,255,0.7); 
            user-select: none; backdrop-filter: blur(2px); touch-action: manipulation; 
        }
        .btn:active { background: rgba(255, 255, 255, 0.4); }
        
        #btn-up { top: 0; left: 50px; width: 50px; height: 50px; } #btn-down { bottom: 0; left: 50px; width: 50px; height: 50px; }
        #btn-left { top: 50px; left: 0; width: 50px; height: 50px; } #btn-right { top: 50px; right: 0; width: 50px; height: 50px; }
        #btn-action { position: static; width: 80px; height: 80px; border-radius: 50%; background: rgba(200, 50, 50, 0.5); font-size: 20px; border: 3px solid rgba(255,255,255,0.5); }

    </style>
</head>
<body>

    <div id="game-wrapper">
        <div id="game-screen">
            <div id="volume-control">
                <span>ðŸŽµ</span>
                <input type="range" id="volume-slider" min="0" max="1" step="0.1" value="0.4">
            </div>

            <img id="bg-layer" class="bg" src="">
            <div id="objects-layer"></div>
            
            <img id="player" class="character game-obj" src="" style="display:none;">
            <img id="npc-ismail" class="npc" src="" style="display:none;">
            <img id="npc-diliara" class="npc" src="" style="display:none;">
            <img id="npc-nika" class="npc" src="" style="display:none;">
            
            <img id="special-obj" class="game-obj" src="" style="display:none;">

            <div id="narrative-screen">
                <p id="narrative-text"></p>
            </div>

            <div id="choice-container">
                <button class="choice-btn" id="btn-kiss" onclick="makeChoice(1)"></button>
                <button class="choice-btn" id="btn-leave" onclick="makeChoice(2)"></button>
            </div>

            <div id="ui-layer">
                <div id="dialogue-box"></div>
                <div id="mobile-controls">
                    <div class="d-pad">
                        <div class="btn" id="btn-up">â–²</div><div class="btn" id="btn-left">â—€</div><div class="btn" id="btn-down">â–¼</div><div class="btn" id="btn-right">â–¶</div>
                    </div>
                    <div class="action-area"><div class="btn" id="btn-action">A</div></div>
                </div>
            </div>
            
            <div id="lang-screen">
                <h1 style="color:#ffeb3b; margin-bottom: 30px;">SELECT LANGUAGE</h1>
                <button class="lang-btn" onclick="setLang('tr')">TÃœRKÃ‡E</button>
                <button class="lang-btn" onclick="setLang('ru')">Ð Ð£Ð¡Ð¡ÐšÐ˜Ð™</button>
            </div>

            <div id="main-menu">
                <div class="title-container">
                    <img src="https://i.imgur.com/ISiHksj.png" class="menu-char">
                    <h1 class="title">Way to<br>Diliara</h1>
                    <img src="https://i.imgur.com/kbKi5Q3.png" class="menu-char">
                </div>
                <button class="menu-btn" id="start-btn" onclick="startGame()"></button>
            </div>

            <div id="end-screen">
                <h1 style="color:red; font-size:30px; margin-bottom:20px; text-align:center;" id="end-title"></h1>
                <p onclick="location.reload()" style="cursor:pointer; border:1px solid white; padding:10px;" id="restart-text"></p>
            </div>
        </div>
    </div>

    <audio id="bg-music" loop>
        <source src="https://commondatastorage.googleapis.com/codeskulptor-demos/riceracer_assets/music/win.ogg" type="audio/ogg"> 
    </audio>

<script>
    // --- PWA SERVICE WORKER KAYIT ---
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./sw.js')
                .then(reg => console.log('SW BaÅŸarÄ±lÄ±:', reg.scope))
                .catch(err => console.log('SW Hata:', err));
        });
    }

    // --- 1. DÄ°L VE METÄ°NLER ---
    let lang = 'tr';
    const texts = {
        tr: {
            start: "HÄ°KAYEYÄ° BAÅžLAT",
            kiss: "Ä°smail'i Ã–p",
            leave: "BoÅŸver Gitsin",
            end_title: "SONSUZA DEK\nBERABER",
            restart: "BaÅŸa DÃ¶n",
            intro: "Ä°smail uyandÄ±... Hayat tatsÄ±zdÄ±, yaÅŸamÄ±n heyecanÄ±nÄ± yitirmiÅŸti. Ama Ã§alÄ±ÅŸmak zorundaydÄ±, Ã§Ã¼nkÃ¼ paranÄ±n ona mutluluk getireceÄŸine inanÄ±yordu.",
            scene1_pc: "Bilgisayar... Sadece iÅŸ iÃ§in kullanÄ±yorum artÄ±k. Oyun oynamak bile zevk vermiyor.",
            scene1_mirror: "GÃ¶zlerimin feri sÃ¶nmÃ¼ÅŸ... Yine de para kazanmak zorundayÄ±m.",
            scene1_bed: "Yatak beni iÃ§ine Ã§ekiyor ama kalkmalÄ±yÄ±m.",
            scene1_door: "Kilitli. AnahtarÄ± bulup Ã§Ä±kmalÄ±yÄ±m.",
            scene1_key: "AnahtarÄ± aldÄ±m. Ä°steksizce de olsa yola koyulalÄ±m.",
            scene2_intro: "Ä°smail, Diliara'yÄ± gÃ¶rdÃ¼... GerÃ§ekten melek gibiydi. UlaÅŸÄ±lmaz olduÄŸunu dÃ¼ÅŸÃ¼ndÃ¼, konuÅŸmaya Ã§ekindi. Ama kader aÄŸlarÄ±nÄ± Ã¶rÃ¼yordu...",
            scene2_dial1: "Diliara: Pardon, bir pasaport kayboldu, yardÄ±m edebilir misin?",
            scene2_dial2: "Ä°smail: Benim problemim deÄŸil. Ã‡ok iÅŸim var, baÅŸÄ±nÄ±n Ã§aresine bak.",
            scene2_dial3: "(Diliara Ã§ok Ã¼zÃ¼ldÃ¼... Ama o pasaportu bulmalÄ±)",
            scene2_found: "Ä°ÅŸte burada! Sonunda buldum.",
            scene3_intro: "Ä°ÅŸ Ã§Ä±kÄ±ÅŸÄ±... Diliara, Ä°smail'den bir Ã§akmak istedi. Sabahki kabalÄ±ÄŸÄ± iÃ§in Ã¼zgÃ¼n olan Ä°smail, bu fÄ±rsatÄ± deÄŸerlendirmeliydi.",
            scene3_dial1: "Diliara: Pardon, Ã§akmaÄŸÄ±n var mÄ± acaba?",
            scene3_dial2: "Ä°smail: Buyur kibrit. Ve... sabahki kabalÄ±ÄŸÄ±m iÃ§in Ã¶zÃ¼r dilerim. Gergin bir gÃ¼ndÃ¼.",
            scene3_dial3: "Diliara: Sorun deÄŸil, olabiliyor bÃ¶yle ÅŸeyler...",
            scene3_dial4: "Ä°smail: Telafi etmek isterim. YarÄ±n sabah SUP turu yapalÄ±m mÄ±?",
            scene3_dial5: "Diliara: Olur, kulaÄŸa harika geliyor!",
            scene4_intro: "Tarih: 31/07/2025, Saat: 04:00.\nÄ°smail, kÄ±zlarÄ± lojmandan almaya geldi. Kalbi yerinden Ã§Ä±kacak gibiydi.",
            scene4_waiting: "(KÄ±zlar geldi, yola Ã§Ä±kÄ±yorlar...)",
            scene5_inner: "Ä°smail: (Ä°Ã§inden) Deniz gÃ¼zel ama Diliara daha gÃ¼zel...",
            scene5_photo: "(Diliara ve Nika fotoÄŸraf Ã§ekiniyor...)",
            scene6_intro: "Harika bir gÃ¼nÃ¼n ardÄ±ndan lojmana dÃ¶nÃ¼ÅŸ vakti gelmiÅŸti. Nika iÃ§eri girdi, Ä°smail ve Diliara yalnÄ±z kaldÄ±.",
            scene6_dial1: "Ä°smail: BugÃ¼n harikaydÄ±. Bir sonraki izin gÃ¼nÃ¼nÃ¼ baÅŸ baÅŸa geÃ§irelim mi?",
            scene6_dial2: "Diliara: Ã‡ok isterim.",
            scene7_intro: "Tarih: 04/08/2025, Saat: 14:00.\nÄ°lk buluÅŸma. Zaman kaybetmeden yola koyuldular.",
            scene7_compliment1: "Ä°smail: Ã‡ok gÃ¼zel gÃ¶rÃ¼nÃ¼yorsun...",
            scene7_compliment2: "Diliara: TeÅŸekkÃ¼r ederim...",
            scene7_reply: "Ä°smail: Hadi zaman kaybetmeyelim.",
            scene7_go: "...",
            scene8_photo: "(Ä°smail sahilde Diliara'nÄ±n fotoÄŸraflarÄ±nÄ± Ã§eker...)",
            scene8_hungry: "Diliara: KarnÄ±m acÄ±ktÄ±...",
            scene8_return: "Ä°smail: Benim de. Hadi dÃ¶nelim.",
            scene9_intro: "DÃ¶nÃ¼ÅŸ yolu 3 saat sÃ¼rdÃ¼. Diliara yorgun dÃ¼ÅŸÃ¼p baÅŸÄ±nÄ± Ä°smail'in omzuna koydu. O an, Ä°smail'in iÃ§inde bir aÅŸk yeÅŸermeye baÅŸladÄ±...",
            scene10_thought: "Ä°smail: Diliara dÄ±ÅŸarÄ±da bekliyor. Paketi alÄ±p hemen Ã§Ä±kayÄ±m.",
            scene10_got: "Cheeseburger menÃ¼leri aldÄ±m. Diliara bekliyor.",
            scene11_intro: "Cheeseburgerlerin Ã¼zerine kola dÃ¶kÃ¼lmÃ¼ÅŸtÃ¼... Ama bu felaket, en gÃ¼zel anÄ±larÄ±ndan birine dÃ¶nÃ¼ÅŸtÃ¼.",
            scene11_laugh: "Diliara: Hahaha! Ä°nanÄ±lmaz... Ä°ÄŸrenÃ§ gÃ¶rÃ¼nÃ¼yor ama yemin ederim Ã¶mrÃ¼mde yediÄŸim en gÃ¼zel hamburger!",
            scene12_intro: "Lojman kapÄ±sÄ±... Diliara gitmek istemiyordu, Ä°smail de Ã¶yle. O an gelmiÅŸti.",
            scene12_go: "Ä°smail: ArtÄ±k gitmem gerek... Saat geÃ§ oldu.",
            scene12_stay: "Diliara: Gitmesen? Biraz daha kalsan...",
            scene12_ok: "Ä°smail: Tamam... Biraz daha.",
            scene12_music: "(Arabada mÃ¼zik Ã§almaya baÅŸlar... Ortam Ä±sÄ±nÄ±r...)",
            final_happy: "Diliara Ä°smail'i Ã¶per...\nVe her ÅŸey bÃ¶yle baÅŸladÄ±... MUTLU SON.",
            final_sad: "Sessizce ayrÄ±ldÄ±lar... Hikaye baÅŸlamadan bitti."
        },
        ru: {
            start: "ÐÐÐ§ÐÐ¢Ð¬ Ð˜Ð¡Ð¢ÐžÐ Ð˜Ð®",
            kiss: "ÐŸÐ¾Ñ†ÐµÐ»Ð¾Ð²Ð°Ñ‚ÑŒ Ð˜ÑÐ¼Ð°Ð¸Ð»Ð°",
            leave: "Ð£Ð¹Ñ‚Ð¸",
            end_title: "Ð’ÐœÐ•Ð¡Ð¢Ð•\nÐÐÐ’Ð¡Ð•Ð“Ð”Ð",
            restart: "ÐÐ°Ñ‡Ð°Ñ‚ÑŒ Ð·Ð°Ð½Ð¾Ð²Ð¾",
            intro: "Ð˜ÑÐ¼Ð°Ð¸Ð» Ð¿Ñ€Ð¾ÑÐ½ÑƒÐ»ÑÑ... Ð–Ð¸Ð·Ð½ÑŒ ÐºÐ°Ð·Ð°Ð»Ð°ÑÑŒ Ð¿Ñ€ÐµÑÐ½Ð¾Ð¹, Ð¾Ð½ Ð¿Ð¾Ñ‚ÐµÑ€ÑÐ» Ð²ÐºÑƒÑ Ðº Ð¶Ð¸Ð·Ð½Ð¸. ÐÐ¾ Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ Ð±Ñ‹Ð»Ð¾ Ð½ÑƒÐ¶Ð½Ð¾, Ð¾Ð½ Ð²ÐµÑ€Ð¸Ð», Ñ‡Ñ‚Ð¾ Ð´ÐµÐ½ÑŒÐ³Ð¸ Ð¿Ñ€Ð¸Ð½ÐµÑÑƒÑ‚ ÑÑ‡Ð°ÑÑ‚ÑŒÐµ.",
            scene1_pc: "ÐšÐ¾Ð¼Ð¿ÑŒÑŽÑ‚ÐµÑ€... Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑŽ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð»Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹. Ð”Ð°Ð¶Ðµ Ð¸Ð³Ñ€Ñ‹ Ð±Ð¾Ð»ÑŒÑˆÐµ Ð½Ðµ Ñ€Ð°Ð´ÑƒÑŽÑ‚.",
            scene1_mirror: "Ð“Ð»Ð°Ð·Ð° Ð¿Ð¾Ñ‚ÑƒÑ…Ð»Ð¸... ÐÐ¾ Ð½ÑƒÐ¶Ð½Ð¾ Ð·Ð°Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°Ñ‚ÑŒ Ð´ÐµÐ½ÑŒÐ³Ð¸.",
            scene1_bed: "ÐšÑ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¼Ð°Ð½Ð¸Ñ‚ Ð¼ÐµÐ½Ñ, Ð½Ð¾ Ð½ÑƒÐ¶Ð½Ð¾ Ð²ÑÑ‚Ð°Ð²Ð°Ñ‚ÑŒ.",
            scene1_door: "Ð—Ð°Ð¿ÐµÑ€Ñ‚Ð¾. ÐÑƒÐ¶Ð½Ð¾ Ð½Ð°Ð¹Ñ‚Ð¸ ÐºÐ»ÑŽÑ‡ Ð¸ Ð²Ñ‹Ð¹Ñ‚Ð¸.",
            scene1_key: "Ð¯ Ð²Ð·ÑÐ» ÐºÐ»ÑŽÑ‡. ÐÐµÐ¾Ñ…Ð¾Ñ‚Ð½Ð¾ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÑŽÑÑŒ Ð² Ð¿ÑƒÑ‚ÑŒ.",
            scene2_intro: "Ð˜ÑÐ¼Ð°Ð¸Ð» ÑƒÐ²Ð¸Ð´ÐµÐ» Ð”Ð¸Ð»Ð¸Ð°Ñ€Ñƒ... ÐžÐ½Ð° Ð±Ñ‹Ð»Ð° ÐºÐ°Ðº Ð°Ð½Ð³ÐµÐ». ÐžÐ½ Ð¿Ð¾Ð´ÑƒÐ¼Ð°Ð», Ñ‡Ñ‚Ð¾ Ð¾Ð½Ð° Ð½ÐµÐ´Ð¾ÑÑÐ³Ð°ÐµÐ¼Ð°, Ð¸ Ð¿Ð¾Ð±Ð¾ÑÐ»ÑÑ Ð·Ð°Ð³Ð¾Ð²Ð¾Ñ€Ð¸Ñ‚ÑŒ. ÐÐ¾ ÑÑƒÐ´ÑŒÐ±Ð° Ð¿Ð»ÐµÐ»Ð° ÑÐ²Ð¾Ð¸ ÑÐµÑ‚Ð¸...",
            scene2_dial1: "Ð”Ð¸Ð»Ð¸Ð°Ñ€Ð°: Ð˜Ð·Ð²Ð¸Ð½Ð¸Ñ‚Ðµ, Ð¿Ð¾Ñ‚ÐµÑ€ÑÐ»ÑÑ Ð¿Ð°ÑÐ¿Ð¾Ñ€Ñ‚, Ð½Ðµ Ð¼Ð¾Ð³Ð»Ð¸ Ð±Ñ‹ Ð²Ñ‹ Ð¿Ð¾Ð¼Ð¾Ñ‡ÑŒ?",
            scene2_dial2: "Ð˜ÑÐ¼Ð°Ð¸Ð»: Ð­Ñ‚Ð¾ Ð½Ðµ Ð¼Ð¾Ñ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð°. Ð£ Ð¼ÐµÐ½Ñ Ð¼Ð½Ð¾Ð³Ð¾ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹, Ñ€Ð°Ð·Ð±Ð¸Ñ€Ð°Ð¹ÑÑ ÑÐ°Ð¼Ð°.",
            scene2_dial3: "(Ð”Ð¸Ð»Ð¸Ð°Ñ€Ð° Ð¾Ñ‡ÐµÐ½ÑŒ Ñ€Ð°ÑÑÑ‚Ñ€Ð¾Ð¸Ð»Ð°ÑÑŒ... ÐÐ¾ Ð¾Ð½Ð° Ð´Ð¾Ð»Ð¶Ð½Ð° Ð½Ð°Ð¹Ñ‚Ð¸ Ð¿Ð°ÑÐ¿Ð¾Ñ€Ñ‚)",
            scene2_found: "Ð’Ð¾Ñ‚ Ð¾Ð½! ÐÐ°ÐºÐ¾Ð½ÐµÑ†-Ñ‚Ð¾ Ð½Ð°ÑˆÐµÐ».",
            scene3_intro: "ÐšÐ¾Ð½ÐµÑ† ÑÐ¼ÐµÐ½Ñ‹... Ð”Ð¸Ð»Ð¸Ð°Ñ€Ð° Ð¿Ð¾Ð¿Ñ€Ð¾ÑÐ¸Ð»Ð° Ñƒ Ð˜ÑÐ¼Ð°Ð¸Ð»Ð° Ð·Ð°Ð¶Ð¸Ð³Ð°Ð»ÐºÑƒ. Ð˜ÑÐ¼Ð°Ð¸Ð», ÑÐ¾Ð¶Ð°Ð»ÐµÑ Ð¾ ÑÐ²Ð¾ÐµÐ¹ ÑƒÑ‚Ñ€ÐµÐ½Ð½ÐµÐ¹ Ð³Ñ€ÑƒÐ±Ð¾ÑÑ‚Ð¸, Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ð» Ð²Ð¾ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒÑÑ ÑÑ‚Ð¸Ð¼ ÑˆÐ°Ð½ÑÐ¾Ð¼.",
            scene3_dial1: "Ð”Ð¸Ð»Ð¸Ð°Ñ€Ð°: Ð˜Ð·Ð²Ð¸Ð½Ð¸Ñ‚Ðµ, Ñƒ Ð²Ð°Ñ ÐµÑÑ‚ÑŒ Ð·Ð°Ð¶Ð¸Ð³Ð°Ð»ÐºÐ°?",
            scene3_dial2: "Ð˜ÑÐ¼Ð°Ð¸Ð»: Ð”ÐµÑ€Ð¶Ð¸ ÑÐ¿Ð¸Ñ‡ÐºÐ¸. Ð˜... Ð¸Ð·Ð²Ð¸Ð½Ð¸ Ð·Ð° ÑƒÑ‚Ñ€ÐµÐ½Ð½ÑŽÑŽ Ð³Ñ€ÑƒÐ±Ð¾ÑÑ‚ÑŒ. Ð‘Ñ‹Ð» Ð½Ð°Ð¿Ñ€ÑÐ¶ÐµÐ½Ð½Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ.",
            scene3_dial3: "Ð”Ð¸Ð»Ð¸Ð°Ñ€Ð°: ÐÐ¸Ñ‡ÐµÐ³Ð¾ ÑÑ‚Ñ€Ð°ÑˆÐ½Ð¾Ð³Ð¾, Ð²ÑÑÐºÐ¾Ðµ Ð±Ñ‹Ð²Ð°ÐµÑ‚...",
            scene3_dial4: "Ð˜ÑÐ¼Ð°Ð¸Ð»: Ð¥Ð¾Ñ‡Ñƒ Ð·Ð°Ð³Ð»Ð°Ð´Ð¸Ñ‚ÑŒ Ð²Ð¸Ð½Ñƒ. ÐŸÐ¾ÐºÐ°Ñ‚Ð°ÐµÐ¼ÑÑ Ð·Ð°Ð²Ñ‚Ñ€Ð° ÑƒÑ‚Ñ€Ð¾Ð¼ Ð½Ð° SUP-Ð±Ð¾Ñ€Ð´Ð°Ñ…?",
            scene3_dial5: "Ð”Ð¸Ð»Ð¸Ð°Ñ€Ð°: Ð¡ ÑƒÐ´Ð¾Ð²Ð¾Ð»ÑŒÑÑ‚Ð²Ð¸ÐµÐ¼, Ð·Ð²ÑƒÑ‡Ð¸Ñ‚ Ð¾Ñ‚Ð»Ð¸Ñ‡Ð½Ð¾!",
            scene4_intro: "Ð”Ð°Ñ‚Ð°: 31/07/2025, Ð’Ñ€ÐµÐ¼Ñ: 04:00.\nÐ˜ÑÐ¼Ð°Ð¸Ð» Ð¿Ñ€Ð¸ÐµÑ…Ð°Ð» Ð·Ð°Ð±Ñ€Ð°Ñ‚ÑŒ Ð´ÐµÐ²ÑƒÑˆÐµÐº. Ð¡ÐµÑ€Ð´Ñ†Ðµ Ð³Ð¾Ñ‚Ð¾Ð²Ð¾ Ð±Ñ‹Ð»Ð¾ Ð²Ñ‹Ð¿Ñ€Ñ‹Ð³Ð½ÑƒÑ‚ÑŒ Ð¸Ð· Ð³Ñ€ÑƒÐ´Ð¸.",
            scene4_waiting: "(Ð”ÐµÐ²ÑƒÑˆÐºÐ¸ Ð¿Ñ€Ð¸ÑˆÐ»Ð¸, Ð¾Ð½Ð¸ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÑŽÑ‚ÑÑ Ð² Ð¿ÑƒÑ‚ÑŒ...)",
            scene5_inner: "Ð˜ÑÐ¼Ð°Ð¸Ð»: (ÐŸÑ€Ð¾ ÑÐµÐ±Ñ) ÐœÐ¾Ñ€Ðµ ÐºÑ€Ð°ÑÐ¸Ð²Ð¾Ðµ, Ð½Ð¾ Ð”Ð¸Ð»Ð¸Ð°Ñ€Ð° ÐºÑ€Ð°ÑÐ¸Ð²ÐµÐµ...",
            scene5_photo: "(Ð”Ð¸Ð»Ð¸Ð°Ñ€Ð° Ð¸ ÐÐ¸ÐºÐ° Ñ„Ð¾Ñ‚Ð¾Ð³Ñ€Ð°Ñ„Ð¸Ñ€ÑƒÑŽÑ‚ÑÑ...)",
            scene6_intro: "ÐŸÑ€Ð¸ÑˆÐ»Ð¾ Ð²Ñ€ÐµÐ¼Ñ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°Ñ‚ÑŒÑÑ Ð² Ð¾Ð±Ñ‰ÐµÐ¶Ð¸Ñ‚Ð¸Ðµ Ð¿Ð¾ÑÐ»Ðµ Ñ‡ÑƒÐ´ÐµÑÐ½Ð¾Ð³Ð¾ Ð´Ð½Ñ. ÐÐ¸ÐºÐ° Ð²Ð¾ÑˆÐ»Ð° Ð²Ð½ÑƒÑ‚Ñ€ÑŒ, Ð˜ÑÐ¼Ð°Ð¸Ð» Ð¸ Ð”Ð¸Ð»Ð¸Ð°Ñ€Ð° Ð¾ÑÑ‚Ð°Ð»Ð¸ÑÑŒ Ð¾Ð´Ð½Ð¸.",
            scene6_dial1: "Ð˜ÑÐ¼Ð°Ð¸Ð»: Ð¡ÐµÐ³Ð¾Ð´Ð½Ñ Ð±Ñ‹Ð»Ð¾ Ñ‡ÑƒÐ´ÐµÑÐ½Ð¾. ÐŸÑ€Ð¾Ð²ÐµÐ´ÐµÐ¼ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ð¹ Ð²Ñ‹Ñ…Ð¾Ð´Ð½Ð¾Ð¹ Ð²Ð´Ð²Ð¾ÐµÐ¼?",
            scene6_dial2: "Ð”Ð¸Ð»Ð¸Ð°Ñ€Ð°: Ð¯ Ð±Ñ‹ Ð¾Ñ‡ÐµÐ½ÑŒ Ñ…Ð¾Ñ‚ÐµÐ»Ð°.",
            scene7_intro: "Ð”Ð°Ñ‚Ð°: 04/08/2025, Ð’Ñ€ÐµÐ¼Ñ: 14:00.\nÐŸÐµÑ€Ð²Ð¾Ðµ ÑÐ²Ð¸Ð´Ð°Ð½Ð¸Ðµ. ÐžÐ½Ð¸ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð¸ÑÑŒ Ð² Ð¿ÑƒÑ‚ÑŒ, Ð½Ðµ Ñ‚ÐµÑ€ÑÑ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸.",
            scene7_compliment1: "Ð˜ÑÐ¼Ð°Ð¸Ð»: Ð¢Ñ‹ Ð¾Ñ‡ÐµÐ½ÑŒ ÐºÑ€Ð°ÑÐ¸Ð²Ð¾ Ð²Ñ‹Ð³Ð»ÑÐ´Ð¸ÑˆÑŒ...",
            scene7_compliment2: "Ð”Ð¸Ð»Ð¸Ð°Ñ€Ð°: Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾...",
            scene7_reply: "Ð˜ÑÐ¼Ð°Ð¸Ð»: ÐŸÐ¾Ð¹Ð´ÐµÐ¼, Ð½Ðµ Ð±ÑƒÐ´ÐµÐ¼ Ñ‚ÐµÑ€ÑÑ‚ÑŒ Ð²Ñ€ÐµÐ¼Ñ.",
            scene7_go: "...",
            scene8_photo: "(Ð˜ÑÐ¼Ð°Ð¸Ð» Ñ„Ð¾Ñ‚Ð¾Ð³Ñ€Ð°Ñ„Ð¸Ñ€ÑƒÐµÑ‚ Ð”Ð¸Ð»Ð¸Ð°Ñ€Ñƒ Ð½Ð° Ð¿Ð»ÑÐ¶Ðµ...)",
            scene8_hungry: "Ð”Ð¸Ð»Ð¸Ð°Ñ€Ð°: Ð¯ Ð¿Ñ€Ð¾Ð³Ð¾Ð»Ð¾Ð´Ð°Ð»Ð°ÑÑŒ...",
            scene8_return: "Ð˜ÑÐ¼Ð°Ð¸Ð»: Ð¯ Ñ‚Ð¾Ð¶Ðµ. Ð”Ð°Ð²Ð°Ð¹ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°Ñ‚ÑŒÑÑ.",
            scene9_intro: "ÐžÐ±Ñ€Ð°Ñ‚Ð½Ð°Ñ Ð´Ð¾Ñ€Ð¾Ð³Ð° Ð·Ð°Ð½ÑÐ»Ð° 3 Ñ‡Ð°ÑÐ°. Ð”Ð¸Ð»Ð¸Ð°Ñ€Ð° ÑƒÑÑ‚Ð°Ð»Ð° Ð¸ Ð¿Ð¾Ð»Ð¾Ð¶Ð¸Ð»Ð° Ð³Ð¾Ð»Ð¾Ð²Ñƒ Ð½Ð° Ð¿Ð»ÐµÑ‡Ð¾ Ð˜ÑÐ¼Ð°Ð¸Ð»Ð°. Ð’ ÑÑ‚Ð¾Ñ‚ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚ Ð² Ð´ÑƒÑˆÐµ Ð˜ÑÐ¼Ð°Ð¸Ð»Ð° Ð½Ð°Ñ‡Ð°Ð»Ð° Ð·Ð°Ñ€Ð¾Ð¶Ð´Ð°Ñ‚ÑŒÑÑ Ð»ÑŽÐ±Ð¾Ð²ÑŒ...",
            scene10_thought: "Ð˜ÑÐ¼Ð°Ð¸Ð»: Ð”Ð¸Ð»Ð¸Ð°Ñ€Ð° Ð¶Ð´ÐµÑ‚ ÑÐ½Ð°Ñ€ÑƒÐ¶Ð¸. Ð’Ð¾Ð·ÑŒÐ¼Ñƒ Ð¿Ð°ÐºÐµÑ‚ Ð¸ ÑÑ€Ð°Ð·Ñƒ Ð²Ñ‹Ð¹Ð´Ñƒ.",
            scene10_got: "Ð¯ Ð²Ð·ÑÐ» Ð¼ÐµÐ½ÑŽ Ñ Ñ‡Ð¸Ð·Ð±ÑƒÑ€Ð³ÐµÑ€Ð°Ð¼Ð¸. Ð”Ð¸Ð»Ð¸Ð°Ñ€Ð° Ð¶Ð´ÐµÑ‚.",
            scene11_intro: "ÐšÐ¾Ð»Ð° Ñ€Ð°Ð·Ð»Ð¸Ð»Ð°ÑÑŒ Ð½Ð° Ñ‡Ð¸Ð·Ð±ÑƒÑ€Ð³ÐµÑ€Ñ‹... ÐÐ¾ ÑÑ‚Ð° ÐºÐ°Ñ‚Ð°ÑÑ‚Ñ€Ð¾Ñ„Ð° Ð¿Ñ€ÐµÐ²Ñ€Ð°Ñ‚Ð¸Ð»Ð°ÑÑŒ Ð² Ð¾Ð´Ð½Ð¾ Ð¸Ð· ÑÐ°Ð¼Ñ‹Ñ… Ð¿Ñ€ÐµÐºÑ€Ð°ÑÐ½Ñ‹Ñ… Ð²Ð¾ÑÐ¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ð¹.",
            scene11_laugh: "Ð”Ð¸Ð»Ð¸Ð°Ñ€Ð°: Ð¥Ð°Ñ…Ð°Ñ…Ð°! ÐÐµÐ²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾... Ð’Ñ‹Ð³Ð»ÑÐ´Ð¸Ñ‚ ÑƒÐ¶Ð°ÑÐ½Ð¾, Ð½Ð¾ ÐºÐ»ÑÐ½ÑƒÑÑŒ, ÑÑ‚Ð¾ ÑÐ°Ð¼Ñ‹Ð¹ Ð²ÐºÑƒÑÐ½Ñ‹Ð¹ Ð±ÑƒÑ€Ð³ÐµÑ€ Ð² Ð¼Ð¾ÐµÐ¹ Ð¶Ð¸Ð·Ð½Ð¸!",
            scene12_intro: "Ð£ Ð´Ð²ÐµÑ€ÐµÐ¹ Ð¾Ð±Ñ‰ÐµÐ¶Ð¸Ñ‚Ð¸Ñ... Ð”Ð¸Ð»Ð¸Ð°Ñ€Ð° Ð½Ðµ Ñ…Ð¾Ñ‚ÐµÐ»Ð° ÑƒÑ…Ð¾Ð´Ð¸Ñ‚ÑŒ, Ð¸ Ð˜ÑÐ¼Ð°Ð¸Ð» Ñ‚Ð¾Ð¶Ðµ. Ð­Ñ‚Ð¾Ñ‚ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚ Ð½Ð°ÑÑ‚Ð°Ð».",
            scene12_go: "Ð˜ÑÐ¼Ð°Ð¸Ð»: ÐœÐ½Ðµ Ð¿Ð¾Ñ€Ð° Ð¸Ð´Ñ‚Ð¸... Ð£Ð¶Ðµ Ð¿Ð¾Ð·Ð´Ð½Ð¾.",
            scene12_stay: "Ð”Ð¸Ð»Ð¸Ð°Ñ€Ð°: ÐÐµ ÑƒÑ…Ð¾Ð´Ð¸... ÐžÑÑ‚Ð°Ð½ÑŒÑÑ ÐµÑ‰Ðµ Ð½ÐµÐ¼Ð½Ð¾Ð³Ð¾...",
            scene12_ok: "Ð˜ÑÐ¼Ð°Ð¸Ð»: Ð¥Ð¾Ñ€Ð¾ÑˆÐ¾... Ð•Ñ‰Ðµ Ñ‡ÑƒÑ‚ÑŒ-Ñ‡ÑƒÑ‚ÑŒ.",
            scene12_music: "(Ð’ Ð¼Ð°ÑˆÐ¸Ð½Ðµ Ð½Ð°Ñ‡Ð¸Ð½Ð°ÐµÑ‚ Ð¸Ð³Ñ€Ð°Ñ‚ÑŒ Ð¼ÑƒÐ·Ñ‹ÐºÐ°... ÐÑ‚Ð¼Ð¾ÑÑ„ÐµÑ€Ð° Ð½Ð°ÐºÐ°Ð»ÑÐµÑ‚ÑÑ...)",
            final_happy: "Ð”Ð¸Ð»Ð¸Ð°Ñ€Ð° Ñ†ÐµÐ»ÑƒÐµÑ‚ Ð˜ÑÐ¼Ð°Ð¸Ð»Ð°...\nÐ˜ Ñ‚Ð°Ðº Ð²ÑÐµ Ð½Ð°Ñ‡Ð°Ð»Ð¾ÑÑŒ... Ð¡Ð§ÐÐ¡Ð¢Ð›Ð˜Ð’Ð«Ð™ ÐšÐžÐÐ•Ð¦.",
            final_sad: "ÐžÐ½Ð¸ Ñ‚Ð¸Ñ…Ð¾ Ñ€Ð°Ð·Ð¾ÑˆÐ»Ð¸ÑÑŒ... Ð˜ÑÑ‚Ð¾Ñ€Ð¸Ñ Ð·Ð°ÐºÐ¾Ð½Ñ‡Ð¸Ð»Ð°ÑÑŒ, Ð½Ðµ ÑƒÑÐ¿ÐµÐ² Ð½Ð°Ñ‡Ð°Ñ‚ÑŒÑÑ."
        }
    };

    function t(key) { return texts[lang][key] || key; }

    function setLang(l) {
        lang = l;
        document.getElementById('lang-screen').style.display = 'none';
        document.getElementById('main-menu').style.display = 'flex';
        document.getElementById('start-btn').innerText = t('start');
        document.getElementById('btn-kiss').innerText = t('kiss');
        document.getElementById('btn-leave').innerText = t('leave');
        document.getElementById('end-title').innerText = t('end_title');
        document.getElementById('restart-text').innerText = t('restart');
    }

    // --- 2. ASSETLER ---
    const assets = {
        bg: {
            s1: 'https://i.imgur.com/diWxiuE.jpeg', s2: 'https://i.imgur.com/WQTC5RR.jpeg',
            s3: 'https://i.imgur.com/Mtw31SF.jpeg', s4: 'https://i.imgur.com/Ueludly.jpeg',
            s5: 'https://i.imgur.com/OlXYwda.jpeg', s6: 'https://i.imgur.com/IfrHdzu.jpeg',
            s7: 'https://i.imgur.com/IfrHdzu.jpeg', s8: 'https://i.imgur.com/jGvUOZf.jpeg',
            s9: 'https://i.imgur.com/V7TucwX.jpeg', s10: 'https://i.imgur.com/vkO1Xh4.jpeg',
            s11: 'https://i.imgur.com/OCymoea.jpeg', s12: 'https://i.imgur.com/Ueludly.jpeg'
        },
        char: {
            ismail: { idle: 'https://i.imgur.com/kbKi5Q3.png', right: 'https://i.imgur.com/vFNHkZ4.png', left: 'https://i.imgur.com/xysu3D3.png', up: 'https://i.imgur.com/AtjW19E.png', down: 'https://i.imgur.com/debi3sf.png', work: 'https://i.imgur.com/pFURCZj.png' },
            diliara: { normal: 'https://i.imgur.com/ISiHksj.png', angel: 'https://i.imgur.com/3EM9mvN.png' },
            nika: 'https://i.imgur.com/ebp19v6.png'
        },
        items: {
            key: 'https://i.imgur.com/8jrIOOf.png', door: 'https://i.imgur.com/v88be8h.png',
            mirror: 'https://i.imgur.com/Fq47Yth.png', pc: 'https://i.imgur.com/JCkBv60.png',
            bed: 'https://i.imgur.com/vW8L2uI.png', desk: 'https://i.imgur.com/rv0ePY6.png',
            passport: 'https://i.imgur.com/eYe7ghV.png', match: 'https://i.imgur.com/vF01aFR.png',
            sup: 'https://i.imgur.com/b10aRt3.png', car: 'https://i.imgur.com/vYk2N5Q.png',
            burger: 'https://i.imgur.com/rI5Fy8B.png', box: 'https://i.imgur.com/BN3L1rb.png'
        }
    };

    // --- 3. OYUN DEÄžÄ°ÅžKENLERÄ° ---
    let currentScene = 0;
    let playerX = 200, playerY = 400;
    let isTalking = false, isCutscene = false;
    let input = { up: false, down: false, left: false, right: false, action: false };
    
    let state = { hasKey: false, keySpawned: false, passportFound: false, passportSpawned: false, matchFound: false, burgerFound: false };

    const el = {
        bg: document.getElementById('bg-layer'),
        player: document.getElementById('player'),
        dialogue: document.getElementById('dialogue-box'),
        narrativeScreen: document.getElementById('narrative-screen'),
        narrativeText: document.getElementById('narrative-text'),
        npcIsmail: document.getElementById('npc-ismail'),
        npcDiliara: document.getElementById('npc-diliara'),
        npcNika: document.getElementById('npc-nika'),
        objLayer: document.getElementById('objects-layer'),
        special: document.getElementById('special-obj')
    };

    const music = document.getElementById('bg-music');
    const volumeSlider = document.getElementById('volume-slider');
    volumeSlider.addEventListener('input', (e) => {
        music.volume = e.target.value;
    });
    // Mobilde slider'Ä± kaydÄ±rÄ±rken oyuna basmayÄ± engelle
    document.getElementById('volume-control').addEventListener('mousedown', (e) => e.stopPropagation());
    document.getElementById('volume-control').addEventListener('touchstart', (e) => e.stopPropagation());

    function playNarrative(text, callback) {
        isCutscene = true;
        el.narrativeScreen.style.display = 'flex';
        el.narrativeText.innerText = "";
        document.getElementById('mobile-controls').style.display = 'none';
        let i = 0;
        function typeWriter() {
            if (i < text.length) {
                el.narrativeText.innerText += text.charAt(i);
                i++;
                setTimeout(typeWriter, 50);
            } else {
                setTimeout(() => {
                    el.narrativeScreen.style.display = 'none';
                    isCutscene = false;
                    if (callback) callback();
                }, 2500);
            }
        }
        typeWriter();
    }

    // --- SAHNE YÃ–NETÄ°MÄ° ---
    function loadScene(sceneId) {
        currentScene = sceneId;
        el.objLayer.innerHTML = '';
        el.player.style.display = 'none';
        el.npcIsmail.style.display = 'none';
        el.npcDiliara.style.display = 'none';
        el.npcNika.style.display = 'none';
        el.special.style.display = 'none';
        el.special.style.transition = 'none';
        el.special.style.transform = 'none';
        document.getElementById('mobile-controls').style.display = 'none';

        switch(sceneId) {
            case 1: // ODA
                setupPlayableScene(assets.bg.s1, assets.char.ismail.idle, 200, 400);
                spawnItem('door', 350, 20, assets.items.door, 80);
                spawnItem('pc', 100, 100, assets.items.pc, 60);
                spawnItem('mirror', 650, 100, assets.items.mirror, 40);
                spawnItem('bed', 80, 400, assets.items.bed, 100);
                break;

            case 2: // OTEL
                playNarrative(t('scene2_intro'), () => {
                    setupPlayableScene(assets.bg.s2, assets.char.diliara.angel, 400, 500);
                    spawnItem('desk', 50, 80, assets.items.desk, 150);
                    el.npcIsmail.src = assets.char.ismail.work;
                    el.npcIsmail.style.left = '90px'; el.npcIsmail.style.top = '70px'; el.npcIsmail.style.zIndex = '15';
                    el.npcIsmail.style.display = 'block';
                });
                break;

            case 3: // SOKAK
                playNarrative(t('scene3_intro'), () => {
                    setupPlayableScene(assets.bg.s3, assets.char.ismail.idle, 100, 300);
                    el.npcDiliara.src = assets.char.diliara.normal;
                    el.npcDiliara.style.left = '600px'; el.npcDiliara.style.top = '300px';
                    el.npcDiliara.style.display = 'block';
                });
                break;

            case 4: runCinematicSequence(4); break;
            case 5: runCinematicSequence(5); break;
            case 6: runCinematicSequence(6); break;
            case 7: runCinematicSequence(7); break;
            case 8: runCinematicSequence(8); break;
            case 9: runCinematicSequence(9); break;

            case 10: // MC DONALDS
                setupPlayableScene(assets.bg.s10, assets.char.ismail.idle, 400, 500);
                showDialogue(t('scene10_thought'), () => {
                    spawnItem('box', 400, 200, assets.items.box, 50);
                });
                break;

            case 11: runCinematicSequence(11); break;

            case 12: // FÄ°NAL
                playNarrative(t('scene12_intro'), () => {
                    el.bg.src = assets.bg.s12;
                    el.player.src = assets.char.ismail.idle; el.player.style.left='300px'; el.player.style.top='400px'; el.player.style.display='block';
                    el.npcDiliara.src = assets.char.diliara.normal; el.npcDiliara.style.left='400px'; el.npcDiliara.style.top='400px'; el.npcDiliara.style.display='block';
                    
                    showDialogue(t('scene12_go'), () => {
                        showDialogue(t('scene12_stay'), () => {
                            showDialogue(t('scene12_ok'), () => {
                                showDialogue(t('scene12_music'), () => {
                                    document.getElementById('choice-container').style.display = 'flex';
                                });
                            });
                        });
                    });
                });
                break;
        }
    }

    function setupPlayableScene(bg, charSprite, x, y) {
        el.bg.src = bg;
        el.player.src = charSprite;
        el.player.style.display = 'block';
        playerX = x; playerY = y;
        updatePlayerPos();
        document.getElementById('mobile-controls').style.display = 'flex';
    }

    function spawnItem(id, x, y, src, w) {
        let img = document.createElement('img');
        img.src = src; img.id = id;
        img.className = 'game-obj item';
        img.style.left = x + 'px'; img.style.top = y + 'px'; img.style.width = w + 'px';
        el.objLayer.appendChild(img);
    }

    // --- ETKÄ°LEÅžÄ°M MANTIÄžI ---
    function checkInteraction() {
        if(isTalking) return;

        if(currentScene === 1) {
            if(checkCol('pc')) showDialogue(t('scene1_pc'));
            else if(checkCol('mirror')) showDialogue(t('scene1_mirror'));
            else if(checkCol('bed')) showDialogue(t('scene1_bed'));
            else if(checkCol('door')) {
                if(state.hasKey) { 
                    loadScene(2); 
                } else {
                    if(!state.keySpawned) {
                        showDialogue(t('scene1_door'));
                        setTimeout(() => {
                            spawnItem('key', 200, 500, assets.items.key, 30);
                            state.keySpawned = true;
                        }, 1000);
                    } else {
                        showDialogue(t('scene1_door'));
                    }
                }
            }
            else if(checkCol('key')) {
                document.getElementById('key').style.display = 'none'; state.hasKey = true;
                showDialogue(t('scene1_key'));
            }
        }
        else if(currentScene === 2) {
            if(checkDist(el.player, el.npcIsmail, 150)) {
                showDialogue(t('scene2_dial1'), () => {
                    showDialogue(t('scene2_dial2'), () => {
                        showDialogue(t('scene2_dial3'), () => {
                            if(!state.passportSpawned) {
                                spawnItem('passport', 700, 100, assets.items.passport, 30);
                                state.passportSpawned = true;
                            }
                        });
                    });
                });
            }
            else if(checkCol('passport')) {
                document.getElementById('passport').style.display = 'none'; state.passportFound = true;
                showDialogue(t('scene2_found'), () => { loadScene(3); });
            }
        }
        else if(currentScene === 3) {
            if(checkDist(el.player, el.npcDiliara, 100)) {
                if(!state.matchFound) {
                    showDialogue(t('scene3_dial1'));
                    setTimeout(() => spawnItem('match', 300, 300, assets.items.match, 30), 500);
                } else {
                    showDialogue(t('scene3_dial2'), () => {
                        showDialogue(t('scene3_dial3'), () => {
                            showDialogue(t('scene3_dial4'), () => {
                                showDialogue(t('scene3_dial5'), () => { loadScene(4); });
                            });
                        });
                    });
                }
            }
            else if(checkCol('match')) {
                document.getElementById('match').style.display = 'none'; state.matchFound = true;
            }
        }
        else if(currentScene === 10) {
            if(checkCol('box')) {
                document.getElementById('box').style.display = 'none';
                showDialogue(t('scene10_got'), () => { loadScene(11); });
            }
        }
    }

    // --- SÄ°NEMATÄ°K SÄ°STEMÄ° ---
    function runCinematicSequence(sceneId) {
        document.getElementById('mobile-controls').style.display = 'none';
        
        if(sceneId === 4) { // LOJMAN
            playNarrative(t('scene4_intro'), () => {
                el.bg.src = assets.bg.s4;
                el.npcIsmail.style.display = 'block'; el.npcIsmail.style.left = '650px'; el.npcIsmail.style.top = '400px'; el.npcIsmail.src = assets.char.ismail.left;
                
                el.npcDiliara.style.display = 'block'; el.npcDiliara.style.left = '50px'; el.npcDiliara.style.top = '400px'; el.npcDiliara.src = assets.char.diliara.normal;
                el.npcNika.style.display = 'block'; el.npcNika.style.left = '100px'; el.npcNika.style.top = '400px'; el.npcNika.src = assets.char.nika;
                
                showDialogue(t('scene4_waiting'), () => {
                    setTimeout(() => {
                        el.npcDiliara.style.transition = 'left 4s'; el.npcDiliara.style.left = '550px';
                        el.npcNika.style.transition = 'left 4s'; el.npcNika.style.left = '600px';
                    }, 500);
                    setTimeout(() => { loadScene(5); }, 5000);
                });
            });
        }
        else if(sceneId === 5) { // DENÄ°Z
            el.bg.src = assets.bg.s5;
            spawnItem('sup1', 200, 350, assets.items.sup, 80); spawnItem('sup2', 400, 350, assets.items.sup, 80); spawnItem('sup3', 600, 350, assets.items.sup, 80);
            
            el.npcIsmail.style.display = 'block'; el.npcIsmail.style.left = '210px'; el.npcIsmail.style.top = '320px'; el.npcIsmail.style.zIndex='95';
            el.npcDiliara.style.display = 'block'; el.npcDiliara.style.left = '410px'; el.npcDiliara.style.top = '320px'; el.npcDiliara.style.zIndex='95';
            el.npcNika.style.display = 'block'; el.npcNika.style.left = '610px'; el.npcNika.style.top = '320px'; el.npcNika.style.zIndex='95';

            setTimeout(() => {
                showDialogue(t('scene5_inner'), () => {
                    setTimeout(() => {
                        showDialogue(t('scene5_photo'), () => {
                            setTimeout(() => { loadScene(6); }, 2000);
                        });
                    }, 2000);
                });
            }, 1000);
        }
        else if(sceneId === 6) { // LOJMAN DÃ–NÃœÅž
            playNarrative(t('scene6_intro'), () => {
                el.bg.src = assets.bg.s6;
                el.npcIsmail.style.display = 'block'; el.npcIsmail.style.left = '200px';
                el.npcDiliara.style.display = 'block'; el.npcDiliara.style.left = '300px';
                el.npcNika.style.display = 'block'; el.npcNika.style.left = '350px';
                
                setTimeout(() => { el.npcNika.style.transition = 'left 2s'; el.npcNika.style.left = '-100px'; }, 1000);
                
                setTimeout(() => {
                    showDialogue(t('scene6_dial1'), () => {
                        showDialogue(t('scene6_dial2'), () => { loadScene(7); });
                    });
                }, 4000);
            });
        }
        else if(sceneId === 7) { // FIRST DATE
            playNarrative(t('scene7_intro'), () => {
                el.bg.src = assets.bg.s7;
                el.npcIsmail.style.display = 'block'; el.npcIsmail.style.left = '200px';
                el.npcDiliara.style.display = 'block'; el.npcDiliara.style.left = '300px';
                
                setTimeout(() => {
                    showDialogue(t('scene7_compliment1'), () => {
                        setTimeout(() => {
                            showDialogue(t('scene7_compliment2'), () => {
                                setTimeout(() => {
                                    showDialogue(t('scene7_reply'), () => {
                                        showDialogue(t('scene7_go'), () => loadScene(8));
                                    });
                                }, 1500);
                            });
                        }, 1500);
                    });
                }, 1000);
            });
        }
        else if(sceneId === 8) { // PHASELIS
            el.bg.src = assets.bg.s8;
            el.npcIsmail.style.display = 'block'; el.npcIsmail.style.left = '350px'; el.npcIsmail.style.top = '450px'; el.npcIsmail.style.zIndex = '100';
            el.npcDiliara.style.display = 'block'; el.npcDiliara.style.left = '450px'; el.npcDiliara.style.top = '450px'; el.npcDiliara.style.zIndex = '100';

            showDialogue(t('scene8_photo'), () => {
                showDialogue(t('scene8_hungry'), () => {
                    showDialogue(t('scene8_return'), () => loadScene(9));
                });
            });
        }
        else if(sceneId === 9) { // ARABA
            playNarrative(t('scene9_intro'), () => {
                el.bg.src = assets.bg.s9;
                el.special.src = assets.items.car;
                el.special.style.display = 'block';
                el.special.style.width = '200px';
                
                el.special.style.left = '800px'; 
                el.special.style.top = '600px';
                el.special.style.transform = 'scale(0.45)';
                
                setTimeout(() => { 
                    el.special.style.transition = 'left 6s linear, top 6s linear'; 
                    el.special.style.left = '-200px'; 
                    el.special.style.top = '-100px'; 
                }, 100);

                setTimeout(() => { loadScene(10); }, 6500);
            });
        }
        else if(sceneId === 11) { // SOKAK YEMEK
            playNarrative(t('scene11_intro'), () => {
                el.bg.src = assets.bg.s11;
                el.objLayer.innerHTML = '';
                spawnItem('eaten_burger', 380, 450, assets.items.burger, 40);
                
                el.npcIsmail.style.display = 'block'; el.npcIsmail.style.left = '300px'; el.npcIsmail.style.top = '450px'; el.npcIsmail.src=assets.char.ismail.right;
                el.npcDiliara.style.display = 'block'; el.npcDiliara.style.left = '450px'; el.npcDiliara.style.top = '450px'; el.npcDiliara.src=assets.char.diliara.normal;

                showDialogue(t('scene11_laugh'), () => {
                    loadScene(12);
                });
            });
        }
    }

    // --- YARDIMCI FONKSÄ°YONLAR ---
    function makeChoice(option) {
        document.getElementById('choice-container').style.display = 'none';
        if(option === 1) {
            showDialogue(t('final_happy'), () => {
                document.getElementById('end-screen').style.display = 'flex';
            });
        } else {
            showDialogue(t('final_sad'), () => {
                location.reload();
            });
        }
    }

    function showDialogue(text, callback) {
        isTalking = true;
        el.dialogue.innerText = text;
        el.dialogue.style.display = 'block';
        setTimeout(() => {
            el.dialogue.style.display = 'none';
            isTalking = false;
            if(callback) callback();
        }, Math.max(2500, text.length * 80)); 
    }

    function checkCol(id) {
        const item = document.getElementById(id);
        if(!item || item.style.display === 'none') return false;
        return checkDist(el.player, item, 80);
    }

    function checkDist(obj1, obj2, dist) {
        const r1 = obj1.getBoundingClientRect();
        const r2 = obj2.getBoundingClientRect();
        const d = Math.hypot(r1.x - r2.x, r1.y - r2.y);
        const scale = document.getElementById('game-wrapper').getBoundingClientRect().width / 800;
        return d < (dist * scale);
    }

    function updatePlayerPos() {
        el.player.style.left = playerX + 'px';
        el.player.style.top = playerY + 'px';
        if (currentScene !== 2) {
            if(input.right) el.player.src = assets.char.ismail.right;
            else if(input.left) el.player.src = assets.char.ismail.left;
            else if(input.up) el.player.src = assets.char.ismail.up;
            else if(input.down) el.player.src = assets.char.ismail.down;
        }
    }

    function gameLoop() {
        if(!isTalking && !isCutscene && document.getElementById('mobile-controls').style.display !== 'none') {
            if(input.up) playerY -= 5;
            if(input.down) playerY += 5;
            if(input.left) playerX -= 5;
            if(input.right) playerX += 5;
            
            if(playerX < 0) playerX = 0; if(playerY < 0) playerY = 0;
            if(playerX > 736) playerX = 736; if(playerY > 536) playerY = 536;

            if(input.action) { checkInteraction(); input.action = false; }
            updatePlayerPos();
        }
        requestAnimationFrame(gameLoop);
    }

    function setupControls() {
        const btn = (id, key) => {
            const el = document.getElementById(id);
            el.addEventListener('touchstart', (e)=>{e.preventDefault(); input[key]=true});
            el.addEventListener('touchend', (e)=>{e.preventDefault(); input[key]=false});
            el.addEventListener('mousedown', ()=>{input[key]=true});
            el.addEventListener('mouseup', ()=>{input[key]=false});
        };
        btn('btn-up','up'); btn('btn-down','down'); btn('btn-left','left'); btn('btn-right','right'); btn('btn-action','action');
        
        window.addEventListener('keydown', (e)=>{
            if(e.key==='ArrowUp') input.up=true; if(e.key==='ArrowDown') input.down=true;
            if(e.key==='ArrowLeft') input.left=true; if(e.key==='ArrowRight') input.right=true;
            if(e.key===' ') input.action=true;
        });
        window.addEventListener('keyup', (e)=>{
            if(e.key==='ArrowUp') input.up=false; if(e.key==='ArrowDown') input.down=false;
            if(e.key==='ArrowLeft') input.left=false; if(e.key==='ArrowRight') input.right=false;
            if(e.key===' ') input.action=false;
        });
    }

    function fitScreen() {
        const s = Math.min(window.innerWidth/800, window.innerHeight/600);
        document.getElementById('game-wrapper').style.transform = `scale(${s})`;
    }
    window.addEventListener('resize', fitScreen);
    window.addEventListener('load', fitScreen);

    function startGame() {
        music.volume = 0.4;
        music.play().catch(e => console.log("MÃ¼zik izni gerekiyor"));
        
        document.getElementById('main-menu').style.display = 'none';
        setupControls();
        gameLoop();
        
        playNarrative(t('intro'), () => {
            loadScene(1);
        });
    }
</script>
</body>
</html>